{% extends 'layout.html' %}   
{% block body %}
<section id="cover" class="min-vh-100 abs-center">
        <div class="container">
                <div class="col-xl-8 col-lg-6 col-md-8 col-sm-10 mx-auto">
                    <h1 class="display-6 py-2 text-truncate  text-center">Crear kayak</h1>
                        <form action="/kayaks/create" method="post" id="formkayak"> 
                          <input type="hidden" name="csrf_token" value = "{{ csrf_token() }}" /> 
                          {% include 'partial/_message.html'%}

                          <div class="alert alert-danger text-center msgerr" role="alert" hidden></div>
                          <div class="row mb-2">
                            <div class="form-group col">
                                <select  name="kayaktypeid"  class="form-control hidemsg" id="kayaktypeid">
                                    <option value="">Seleccionar tipo de kayak</option>
                                    {%  for tpk in ktype %}
                                      <option value="{{ tpk.id}}"   name="kayaktypeid">{{tpk.name}}</option>
                                    {% endfor %}
                                  </select>
                            </div>
                            <div class="form-group col">
                                <select  name="partner"  class="form-control hidemsg" id="partner">
                                    <option value="">Seleccionar dueño del  kayak</option>
                                    {%  for part in partners %}
                                       <option value="{{ part.id}}"   name="partner">{{part.firstName }} {{ part.lastName}}</option>
                                    {% endfor %}
                                  </select>
                            </div>
                          </div>

                            <div class="row mb-2">
                              <div class="form-group col">
                                <select  name="locationId"  class="form-control hidemsg" id="locationId">
                                    <option value="">Seleccionar la urbicacion</option>
                                    {%  for urb in locations %}
                                      <option value="{{ urb.id}}"   name="locationId" onchange="setVariable(urb.id)">{{urb.name}}</option>
                                    {% endfor %}
                                  </select>
                              </div>
                              <div class="form-group col" >
                                <select  name="hangerId"  class="form-control addselect hidemsg" id="hangerId" disabled>
                                  <option value="">Seleccionar el Nro. de la  percha</option>
                                </select>
                              </div>
                            </div>
                            
                            <div class="row mb-2">
                              <div class="form-group col-md-4">
                                <input type="text" class="form-control hidemsg" id="nroKayak" placeholder="Nro. Kayak" name="nroKayak">
                              </div>
                              <div class="form-group col-md-4">
                                <input type="text" class="form-control hidemsg" id="shovelQuantity"  placeholder="Cantidad de pala" name="shovelQuantity">
                              </div>
                              <div class="form-group col-md-4">
                                <input type="text" class="form-control hidemsg" id="crewmember" placeholder="Cantidad de persona" name="crewmember">
                              </div>
                            </div>
  
                            <div class="float-right mb-3" style="float: right;">
                              <a href="{{ url_for('kayaks.getAll') }}" class="btn btn-primary mr-3">Cancelar</a>
                              <button type="submit" id="btnkayaksub" class="btn btn-primary">Guardar</button>
                            </div>
                        </form>
                </div>
        </div>
    <!-- </div> -->
  </section>

  <script  type="text/javascript">
    $( document ).ready(function() {
      
        $("#locationId").on("change", function(){
          $.ajax({
              url:`/selectHangers/${$(this).val()}`,
              method: "GET",
              headers: { "Accept": "application/json; odata=verbose" },
              cache: false,
              success: function(resp){
                let divselet = '';
                $(".addselect").empty();
                divselet ='<option value="">Seleccionar el Nro. de la  percha</option>'
                if(resp.hangers.length > 0){
                  $("#hangerId").prop('disabled', false);
                    for (let index = 0; index < resp.hangers.length; index++) {
                      const element = resp.hangers[index];      
                      divselet +='<option value='+ element.id +' name="hangerId">'+ element.nroHanger +'</option>'
                    }
                  $(".addselect").append(divselet);
                }
                else{
                  $("#hangerId").prop('disabled', true);
                  $(".addselect").append(divselet);
                }
              },
              error:function(err){
                  $("#hangerId").prop('disabled', true);
                alert("Error");
              }
            });
          
          });   
    
      
        $("#btnkayaksub").on("click", async function(e){
          if($("#kayaktypeid").val() === ""){
            $(".msgerr").prop('hidden', false);
            $(".msgerr").html("Debe seleccionar el tipo de kayak");
            e.preventDefault();
            return;
          }
          if($("#partner").val() === ""){
            $(".msgerr").prop('hidden', false);
            $(".msgerr").html("Debe seleccionar el dueño del kayak");
            e.preventDefault();
            return;
          }

          if($("#locationId").val() === ""){
            $(".msgerr").prop('hidden', false);
            $(".msgerr").html("Debe seleccionar la urbicación");
            e.preventDefault();
            return;
          }
          
          if($("#hangerId").val() === ""){
            $(".msgerr").prop('hidden', false);
            $(".msgerr").html("Debe seleccionar el NRO. de percha");
            e.preventDefault();
            return;
          }
          
          if($("#nroKayak").val() === ""){
            $(".msgerr").prop('hidden', false);
            $(".msgerr").html("Debe ingresar el NRO. de kayak");
            e.preventDefault();
            return;
          }
          
          if($("#shovelQuantity").val() === ""){
            $(".msgerr").prop('hidden', false);
            $(".msgerr").html("Debe ingresar la cantidad de pala");
            e.preventDefault();
            return;
          }
          
          if($("#crewmember").val() === ""){
            $(".msgerr").prop('hidden', false);
            $(".msgerr").html("Debe ingresar la cantidad de persona");
            e.preventDefault();
            return;
          }
        })

        $(".hidemsg").on("click",function(){
          $(".msgerr").prop('hidden', true);
        });

         $("#nroKayak").on("blur", function(e){
          $.ajax({
              url:`/selecKayakNro/${$("#nroKayak").val()}`,
              method: "GET",
              headers: { "Accept": "application/json; odata=verbose" },
              cache: false,
              success: function(resp){
                if(resp.kayak.length > 0){
                  $(".msgerr").prop('hidden', false);
                  $(".msgerr").html("Ya existe un kayak registrado con ese numero");
                  e.preventDefault();
                }
              },
              error:function(err){
                return false;
              }
            });
         })
    });
    
  </script>
  {% endblock %}
  
